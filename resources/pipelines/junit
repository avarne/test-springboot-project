pipeline
	{
		agent 
			{
				label 'master'
			}
		stages
			{
				stage('Run Maven Junit')
					{
						steps
							{
								echo "execute junit tests"
								sh "mvn clean test"
								sh "cd target/surefire-reports && zip -r junitresults.zip . && aws s3 cp junitresults.zip s3://ibmpilot/junit/junitresults.zip"
							}

					}

				stage('Run Sonar')
					{	
						steps
							{
								echo "execute Sonar"
								sh "mvn sonar:sonar -Dsonar.projectKey=spring-boot-mvn-courses -Dsonar.host.url=https://ibm-sonar.digite.com -Dsonar.login=7a0da1e648e56a6bfce26777c747b5cf6e0320e4"
							}
					}

				stage('Create Artifact')
					{
						steps
							{
								echo "Create Artifact"
								sh "mvn clean install"
								sh "cd target && aws s3 cp SwiftEntp-services-0.0.1-SNAPSHOT.jar s3://ibmpilot/artefact/ENTPservice.jar"
							}
					}		
			}
	}